{% load i18n %}
{% load static %}

<style>
  @page {
   size: A4;
   font-family: arial, sans-serif;
   font-size: 10px;
   margin-top: 25px;
   @bottom-right {
     content: "page " counter(page) "/" counter(pages);
   }
   @bottom-left {
     content: "Tél.: {{ administrative_entity.phone }}";
   }
   @bottom-center {
     content: "{{ administrative_entity.link }}";
   }
  }
</style>

<div id=header>
  <img id="logo_main" src="data:image/png;base64,{{logo_main}}" alt="">
  <img id="logo_secondary" src="data:image/png;base64,{{logo_secondary}}" alt="">
</div>
  <div class="banner_center">Permis N°{{ permit_request.id }}</div>
<hr>
<h3>Agenda</h3>
{% for geo_time in geo_times %}
  <p>Date de début: {{ geo_time.starts_at }} - Date de fin: {{ geo_time.ends_at }}</p>
  {% if geo_time.comment %}
    <p>Commentaire: {{ geo_time.comment }}</p>
  {% endif %}
  {% if geo_time.comment %}
    <p>Lien externe: {{ geo_time.external_link }}</p>
  {% endif %}
{% endfor %}
<h3>{% trans "Objet(s) du permis" %}</h3>
{% for object, properties, appendices in objects_infos %}
  <h4>{{ object }}</h4>
  <dl>
    {% for field in properties %}
      <p>
        {{ field.label }}:
        {% if not field.value %}
          <em>{% trans "Information non fournie" %}</em>
        {% else %}
          {{ field.value }}
        {% endif %}
      </p>
    {% endfor %}
    <h4>{% trans "Document(s)" %}</h4>
    {%if appendices %}
      {% for field in appendices %}
        <p>
        {{ field.label }}:
          {% if not field.value %}
            <em>{% trans "Information non fournie" %}</em>
          {% else %}
            <a href="{{ field.value.url }}" target="_blank">{{ field.value.name }}</a>
          {% endif %}
        </p>
      {% endfor %}
    {% endif %}
{% endfor %}
<p style="page-break-before: always" ></p>
<table>
  <caption>Remarque(s)</caption>
  <tr>
    <th>Service</th>
    <th>Commentaire</th>
  </tr>
    {% for validation in validations %}
      <tr>
        <td>
          {{validation.department}}
        </td>
        <td class="controlled-line-height">
            <p><h5>{% trans "Avant" %}</h5></p>
            <p>{{validation.comment_before}}</p>
            <p><h5>{% trans "Pendant" %}</h5></p>
            <p>{{validation.comment_during}}</p>
            <p><h5>{% trans "Après" %}</h5></p>
            <p>{{validation.comment_after}}</p>
        </td>
      </tr>
    {% endfor %}
</table>

<p style="page-break-before: always" ></p>
{% if contacts %}
  <h3>{% trans "Contacts" %}</h3>
  <hr>
  <h5>{% trans "Auteur de la demande" %}</h5>
  {% for field_label, field_value in author.fields %}
  <p>
    {% if field_value %}
        {{ field_label }}:
        {{ field_value }}
    {% endif %}
  </p>
  {% endfor %}
  {% for contact_type, contact_infos in contacts %}
    <h5>{{ contact_type }}</h5>
      {% for field_label, field_value in contact_infos %}
      <p>
        {% if field_value %}
            {{ field_label }}:
            {{ field_value }}
        {% endif %}
      </p>
      {% endfor %}
  {% endfor %}
{% endif %}
<p style="page-break-before: always" ></p>
<h3> Plan de situation </h3>
<div id="print-map-container">
  <img src="{{map_image}}" alt="" class="map-print-image">
</div>
<p style="page-break-before: always" ></p>
<h3> Signatures </h3>
<br><br><br>
<hr>
<div class="row">
  <div class="column">
    <b>{{ administrative_entity.title_signature_1 }}</b>
      <p>  <img id="image_signature_1" src="data:image/png;base64,{{image_signature_1}}" alt=""></p>
  </div>
  <div class="column">
    <b>{{ administrative_entity.title_signature_2 }}</b>
      <p>  <img id="image_signature_2" src="data:image/png;base64,{{image_signature_2}}" alt=""></p>
  </div>
</div>
<div id="print_date">pdf du {{print_date}}</div>
